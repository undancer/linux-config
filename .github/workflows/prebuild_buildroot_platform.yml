name: PREBUILD __BR2__

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    #   - uses: actions/checkout@v3

      - name: Checkout buildroot
        uses: actions/checkout@v3
        with:
          repository: buildroot/buildroot
        #   ref: 2023.02.x
        #   path: buildroot
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
            # context: $GITHUB_WORKSPACE/support/docker
          context: support/docker
          push: false
          tags: undancer/buildroot:latest

    #   - uses: earthly/actions-setup@v1
    #     with:
    #       github-token: ${{ secrets.GITHUB_TOKEN }}
    #       version: "latest" # or pin to an specific version, e.g. "0.7.1"
    #   # # Runs a single command using the runners shell
    #   # - name: Run a one-line script
    #   #   run: echo Hello, world!

    #   # # Runs a set of commands using the runners shell
    #   # - name: Run a multi-line script
    #   #   run: |
    #   #     echo Add other actions to build,
    #   #     echo test, and deploy your project.
    #   #     echo $(uname -m)
    #   #     echo earthly +run

    #   # - name: Docker login # to avoid dockerhub rate-limiting
    #   #   run: docker login --username "${{ secrets.DOCKERHUB_USERNAME }}" --password "${{ secrets.DOCKERHUB_PASSWORD }}"
    #   - name: what version is installed?
    #     run: earthly --version
    #   # - name: run the earthly hello world
    #   #   run: earthly github.com/earthly/hello-world:main+hello
    #   - name: run in earthly
    #     run: earthly --allow-privileged +run
    #   - uses: actions/upload-artifact@v3
    #     with:
    #       name: dist-only-yaml
    #       path: |
    #         dist/*.yaml
    #   - name: Archive production artifacts
    #     uses: actions/upload-artifact@v3
    #     with:
    #       name: dist
    #       path: |
    #         dist
